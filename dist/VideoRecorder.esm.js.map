{"version":3,"file":"VideoRecorder.esm.js","sources":["../src/VideoRecorder.ts"],"sourcesContent":["import {\n  VideoRecorderOptions,\n  RecordingResult,\n  RecordingState,\n  RecordingStats,\n} from \"./types\";\n\nexport  class VideoRecorder {\n  private mediaRecorder: MediaRecorder | null = null;\n  private stream: MediaStream | null = null;\n  private chunks: Blob[] = [];\n  private options: VideoRecorderOptions;\n  private previewElement: HTMLVideoElement | null = null;\n  private recordingStartTime: number = 0;\n  private recordingState: RecordingState = \"inactive\";\n\n  constructor(options: VideoRecorderOptions = {}) {\n    this.options = {\n      mimeType: this.getBestMimeType(),\n      videoBitsPerSecond: options.videoBitsPerSecond || 2500000,\n      audioBitsPerSecond: options.audioBitsPerSecond || 128000,\n      width: options.width || 1280,\n      height: options.height || 720\n    };\n  }\n\n  public async startPreview(\n    previewElement: HTMLVideoElement,\n    constraints: MediaStreamConstraints\n  ): Promise<boolean> {\n    try {\n      await this.stopStream();\n      \n      const stream = await navigator.mediaDevices.getUserMedia(constraints);\n      this.stream = stream;\n      this.previewElement = previewElement;\n      \n      if (this.previewElement) {\n        this.previewElement.srcObject = stream;\n        this.previewElement.muted = true;\n        await this.previewElement.play();\n      }\n      \n      return true;\n    } catch (error) {\n      console.error('Error starting preview:', error);\n      return false;\n    }\n  }\n\n  public async startRecording(constraints: MediaStreamConstraints): Promise<boolean> {\n    try {\n      \n      const stream = await navigator.mediaDevices.getUserMedia(constraints);\n      this.stream = stream;\n\n    \n      if (this.previewElement) {\n        this.previewElement.srcObject = stream;\n      }\n\n      \n      this.mediaRecorder = new MediaRecorder(stream, {\n        mimeType: this.options.mimeType,\n        videoBitsPerSecond: this.options.videoBitsPerSecond,\n        audioBitsPerSecond: this.options.audioBitsPerSecond\n      });\n\n      this.chunks = [];\n      this.mediaRecorder.ondataavailable = (e) => {\n        if (e.data.size > 0) {\n          this.chunks.push(e.data);\n        }\n      };\n\n      this.recordingStartTime = Date.now();\n      this.recordingState = \"recording\";\n      this.mediaRecorder.start(1000); // Start recording with 1 seconds chunks\n      return true;\n    } catch (error) {\n      console.error('Error starting recording:', error);\n      return false;\n    }\n  }\n\n  public async switchDevice(constraints: MediaStreamConstraints): Promise<boolean> {\n    try {\n      await this.stopStream();\n      \n      \n      const stream = await navigator.mediaDevices.getUserMedia(constraints);\n      this.stream = stream;\n\n      \n      if (this.previewElement) {\n        this.previewElement.srcObject = stream;\n        await this.previewElement.play();\n      }\n\n      \n      if (this.mediaRecorder?.state === 'recording') {\n        const recordedChunks = this.chunks;\n        \n        this.mediaRecorder = new MediaRecorder(stream, {\n          mimeType: this.options.mimeType,\n          videoBitsPerSecond: this.options.videoBitsPerSecond,\n          audioBitsPerSecond: this.options.audioBitsPerSecond\n        });\n\n        this.chunks = recordedChunks;\n        this.mediaRecorder.ondataavailable = (e) => {\n          if (e.data.size > 0) {\n            this.chunks.push(e.data);\n          }\n        };\n\n        this.mediaRecorder.start(1000);\n      }\n\n      return true;\n    } catch (error) {\n      console.error('Error switching device:', error);\n      return false;\n    }\n  }\n\n  private async stopStream(): Promise<void> {\n    if (this.mediaRecorder?.state === 'recording') {\n      this.mediaRecorder.stop();\n    }\n    \n    if (this.stream) {\n      this.stream.getTracks().forEach(track => track.stop());\n    }\n  }\n\n  public async stopRecording(): Promise<RecordingResult> {\n    return new Promise((resolve, reject) => {\n      if (!this.mediaRecorder) {\n        reject(new Error('No MediaRecorder instance found'));\n        return;\n      }\n\n      this.mediaRecorder.onstop = () => {\n        const blob = new Blob(this.chunks, { type: this.options.mimeType });\n        const endTime = Date.now();\n        const duration = endTime - this.recordingStartTime;\n        \n        this.chunks = [];\n        this.recordingState = \"inactive\";\n        \n        resolve({\n          blob,\n          duration,\n          size: blob.size\n        });\n      };\n\n      try {\n        this.mediaRecorder.stop();\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n\n  public getMediaStream(): MediaStream | null {\n    return this.stream;\n  }\n\n  public isRecording(): boolean {\n    return this.mediaRecorder?.state === 'recording';\n  }\n\n  public saveVideo(blob: Blob, filename: string): void {\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    document.body.appendChild(a);\n    a.style.display = 'none';\n    a.href = url;\n    a.download = filename;\n    a.click();\n    URL.revokeObjectURL(url);\n    document.body.removeChild(a);\n  }\n\n  public getRecordingStats(): RecordingStats {\n    return {\n      startTime: this.recordingStartTime,\n      endTime: this.recordingState === \"recording\" ? null : Date.now(),\n      duration: this.recordingState === \"recording\" ? Date.now() - this.recordingStartTime : 0,\n      state: this.recordingState,\n      mimeType: this.getBestMimeType(),\n      size: this.chunks.reduce((total, chunk) => total + chunk.size, 0)\n    };\n  }\n\n  public getRecordingState(): RecordingState {\n    return this.recordingState;\n  }\n\n  private getBestMimeType(): string {\n    const types = [\n      'video/webm;codecs=vp9,opus',\n      'video/webm;codecs=vp8,opus',\n      'video/webm',\n    ];\n\n    for (const type of types) {\n      if (MediaRecorder.isTypeSupported(type)) {\n        return type;\n      }\n    }\n\n    return '';\n  }\n\n  public static isSupported(): boolean {\n    return !!(navigator.mediaDevices &&\n      navigator.mediaDevices.getUserMedia &&\n      window.MediaRecorder);\n  }\n\n  public static async getDevices(): Promise<{\n    audioDevices: MediaDeviceInfo[];\n    videoDevices: MediaDeviceInfo[];\n  }> {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true, video: true });\n      \n      const devices = await navigator.mediaDevices.enumerateDevices();\n      return {\n        audioDevices: devices.filter(device => device.kind === 'audioinput'),\n        videoDevices: devices.filter(device => device.kind === 'videoinput')\n      };\n    } catch (error) {\n      console.error('Error getting devices:', error);\n      return { audioDevices: [], videoDevices: [] };\n    }\n  }\n}\n\nexport * from \"./types\";\n"],"names":[],"mappings":"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"}